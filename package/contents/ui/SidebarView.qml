import QtQuick
import QtQuick.Layouts
import org.kde.plasma.core as PlasmaCore
import org.kde.plasma.extras as PlasmaExtras
import org.kde.config as KConfig
import org.kde.draganddrop as DragAndDrop
import org.kde.kcmutils as KCM // KCMLauncher
import "Utils.js" as Utils

Item {
	id: sidebarView
	anchors.left: parent.left
	anchors.top: parent.top
	anchors.bottom: parent.bottom
	z: 1

	width: sidebarMenu.width
	Behavior on width { NumberAnimation { duration: 100 } }

	DragAndDrop.DropArea {
		anchors.fill: sidebarMenu

		onDrop: {
			if (event && event.mimeData && event.mimeData.url) {
				var url = event.mimeData.url.toString()
				url = Utils.parseDropUrl(url)
				appsModel.sidebarModel.addFavorite(url, 0)
			}
		}
	}

	SidebarMenu {
		id: sidebarMenu
		anchors.left: parent.left
		anchors.top: parent.top
		anchors.bottom: parent.bottom


		ColumnLayout {
			id: sidebarMenuTop
			spacing: 0

			// SidebarItem {
			// 	icon.name: 'open-menu-symbolic'
			// 	text: i18n("Menu")
			// 	closeOnClick: false
			// 	onClicked: sidebarMenu.open = !sidebarMenu.open
			// 	zoomOnPush: expanded
			// }

			SidebarViewButton {
				appletIconName: "view-tilesonly"
				text: i18n("Tiles Only")
				onClicked: searchView.showTilesOnly()
				checked: searchView.showingOnlyTiles
				visible: checked || plasmoid.configuration.defaultAppListView == 'TilesOnly'

				viewBoxSize: 16
				PathSvg { path: "m 1,3 v 4 h 9 V 3 Z M 2,4 H 9 V 6 H 2 Z" }
				PathSvg { path: "m 11,3 v 4 h 4 V 3 Z m 1,1 h 2 v 2 h -2 z" }
				PathSvg { path: "M 1,8 1,12 H 5 l 0,-4 z m 1,1 h 2 l 0,2 H 2 Z" }
				PathSvg { path: "M 6,8 V 12 h 9 V 8 Z m 1,1 h 7 V 11 H 7 Z" }
			}
			SidebarViewButton {
				appletIconName: "view-list-alphabetically"
				text: i18n("Alphabetical")
				onClicked: appsView.showAppsAlphabetically()
				checked: searchView.showingAppsAlphabetically

				viewBoxSize: 16
				PathSvg { path: "M 4.09375,2 C 3.31051,2.0182 2.71841,2.14339 2.28125,2.34375 L 2.53125,3.25 C 2.74072,3.1771 3.53552,2.9375 4,2.9375 H 4.0625 C 4.70913,2.9648 4.75,3.19445 4.75,3.75 V 3.96875 L 4.40625,4.03125 C 2.83976,4.25893 2,4.45406 2,5.65625 2,6.49414 2.61657,7 3.5,7 4.1102,7 4.49642,6.75233 4.90625,6.40625 L 5,7 H 6 V 3.53125 C 6,2.50211 5.2804,2 4.1875,2 Z M 4.75,4.6875 v 1.125 C 4.41303,6.0402 4.15591,6.1875 3.71875,6.1875 3.32713,6.1875 3.125,5.93983 3.125,5.59375 c 0,-0.65574 0.57997,-0.77482 1.28125,-0.875 z M 2,9 v 1 H 4.375 L 2,13.318359 V 14 H 6 V 13 H 4 L 6,10 V 9 Z" }
				PathSvg { path: "M 7.25,2 V 2.75 H 14 V 2 Z m 0,1.5 v 0.75 h 4.5 V 3.5 Z m 0,3 V 7.25 H 14 V 6.5 Z m 0,1.5 v 0.7499999 h 1.5 V 8 Z m 0,3 v 0.75 H 14 V 11 Z m 0,1.5 v 0.75 h 4.5 V 12.5 Z m 5.25,0.75 V 14 H 14 v -0.75 z" }
			}
			SidebarViewButton {
				appletIconName: 'view-list-categorically'
				text: i18n("Categories")
				onClicked:  appsView.showAppsCategorically()
				checked: searchView.showingAppsCategorically

				viewBoxSize: 24
				PathSvg { path: "M 6.0000001,1.4e-7 C 2.9624339,1.4e-7 0.50000004,2.4624297 0.50000004,5.5000002 0.50000004,8.5375704 2.9624339,11 6.0000001,11 9.0375657,11 11.5,8.5375704 11.5,5.5000002 11.5,2.4624297 9.0375657,1.4e-7 6.0000001,1.4e-7 Z m 0,0.91666667 c 0.1582065,0 0.304255,0.0129983 0.4583333,0.0286458 0.036978,0.003639 0.077879,-0.00451 0.1145833,0 0.048236,0.006114 0.095473,0.0210457 0.1432292,0.0286458 0.1316812,0.0206983 0.2447732,0.0542886 0.3723958,0.0859375 0.2352136,0.058022 0.4681631,0.1363949 0.6875,0.2291666 0.1209322,0.05115 0.2283866,0.1109035 0.34375,0.171875 0.2005869,0.1147362 0.018086,0.2893216 0.028646,0.4583334 C 8.3456254,1.9042057 8.5766071,1.8550456 8.7213542,1.8333335 8.5506361,1.9957151 8.241229,2.0619644 8.1197917,2.1197918 8.6222653,2.2256933 8.1733462,2.4946733 8.1770834,2.5208335 H 8.1197917 C 7.6787345,2.340912 7.8815537,2.7273061 7.6901042,2.8932293 c 0.062753,0.1687696 0.1455401,0.1455398 0.2578125,0.2578125 0,0.032083 -0.00843,0.083508 -0.028646,0.1145834 -0.040333,0.0605 -0.1141278,0.052938 -0.171875,0.085937 C 7.4750538,3.7134612 7.1245904,3.9631408 7.002604,4.411458 6.946521,4.6175696 6.910137,4.9321896 6.973958,5.1276038 7.1025912,5.521466 7.3944234,5.8384921 7.7473955,5.8437497 c 0.8235013,0.012266 1.1442466,0.1360518 1.4322917,0.5729166 0.03025,0.0385 0.077917,0.07315 0.1145833,0.1145834 0.1215399,0.094528 0.1401134,0.2438267 0.1432292,0.34375 0.00825,0.2634348 -0.1973556,0.4144471 -0.2864584,0.6015625 -0.032285,0.3726011 0.1663347,1.1293535 0.171875,1.1744791 -0.027317,0.028756 -0.057897,0.057897 -0.085937,0.085937 -0.2073555,0.2073555 -0.4436648,0.4081853 -0.6875,0.5729167 -0.4730394,0.3195793 -0.9991746,0.5623273 -1.5755208,0.6875 -0.3149108,0.068393 -0.6385604,0.085938 -0.9739583,0.085938 -0.174472,0 -0.3466237,-0.0092 -0.515625,-0.02865 C 5.3497524,10.039323 5.2141545,10.024165 5.0833334,9.997396 4.8237568,9.9442788 4.5801091,9.8345648 4.3385417,9.7395835 5.2233466,8.8449599 6.3807876,7.8129427 6.3151042,6.8463543 6.274159,6.2438103 5.3212818,6.2250099 4.9401042,5.872396 4.2284017,5.3276507 3.6122939,5.2953936 3.1354167,5.2135418 2.9402589,5.1800447 2.8987633,5.391032 2.7916667,5.4713543 c -0.038518,0 -0.051105,-0.041708 -0.085937,-0.057292 -0.1054066,-0.045833 -0.1707384,0.026813 -0.257813,0.028646 -0.3756603,-0.044855 -0.082125,-0.3695643 -0.1145833,-0.515625 0.00101,-0.056833 -0.1065662,-0.079429 -0.1432292,-0.085937 -0.086162,-0.015583 -0.1883828,0.0385 -0.2864583,0 0.051113,-0.1562536 0.1136831,-0.2652607 0.171875,-0.4010417 0.00353,-0.031167 -0.032587,-0.065771 -0.057292,-0.085937 -0.2275197,0.027746 -0.2980782,0.167669 -0.4583333,0.2578125 -0.016789,0.00917 -0.038482,-0.00183 -0.057292,0 0.00179,-0.00927 -0.00184,-0.019393 0,-0.028646 0.00427,-0.020885 0.024089,-0.036511 0.028646,-0.057292 C 1.5965766,4.2281284 1.6975283,3.9397734 1.817708,3.6666668 H 1.846354 C 2.1926177,3.518262 2.4534845,3.7808905 2.734375,3.9531252 2.6983137,3.4838006 2.9556332,3.3900627 3.3072917,3.1510418 3.3603969,2.8266212 3.6098839,2.8065358 3.9088542,2.6640626 4.2897617,2.3119572 4.2262275,2.4356212 4.6822917,2.3489585 4.8723631,2.044055 5.0854199,2.275671 5.3697917,2.2343751 c -0.064144,-0.290661 0,-0.2695346 0,-0.5442708 C 5.1500001,1.5268102 5.1896109,1.3625028 5.0546876,1.1171876 5.0625713,1.0009589 5.3569482,1.001162 5.5416667,0.94531264 5.6940522,0.92929958 5.84316,0.91666681 6.0000001,0.91666681 Z M 9.2656251,2.5494793 C 9.4901873,2.6310003 9.5382115,2.8640026 9.6380209,2.9791668 9.7978692,3.2845481 9.9999007,3.5203521 9.9531251,3.6093752 9.7866208,3.669605 9.465045,3.4055567 9.2083334,3.294271 9.1982501,3.2603543 9.2924376,3.2370252 9.2942709,3.2083335 9.2663905,3.1598647 9.2753032,3.1134942 9.2656251,3.0651043 8.8967465,2.9303684 8.5828404,3.1008025 8.2630209,3.2083335 8.1437937,3.2484204 7.9610636,3.1443343 8.0052084,3.122396 8.3209368,2.8132701 8.6968902,2.6888432 8.9791667,2.5208335 9.0561851,2.3295061 9.2027362,2.5431901 9.2656251,2.5494793 Z M 1.4739584,4.8697918 c 0.3737914,0.1539771 0.537567,0.3831313 0.8020833,0.6302084 0.015579,0.00917 0.033424,-0.00917 0.057292,0 0.060494,0.018333 0.090982,0.1013375 0.1432291,0.085937 0.021237,-0.2727334 0.1872399,0 0.2005209,0 0.011898,0.031167 0.049074,0.052938 0.057292,0.085937 C 2.8184691,5.9434099 2.5877778,6.0200436 2.5052084,6.216146 2.3607397,6.6542917 2.5925905,7.0015608 2.8776042,7.419271 3.0080099,7.6103905 3.349647,7.5841088 3.4218751,7.7916668 3.6080444,8.3266518 3.5075137,8.8831208 3.5364584,9.3671877 3.5072662,9.3484143 3.4792538,9.329311 3.4505209,9.309896 3.206686,9.1451646 2.9703759,8.9443348 2.7630209,8.7369793 2.7349769,8.7089358 2.7043963,8.6798013 2.6770834,8.6510418 2.5115509,8.4767404 2.3554594,8.2767503 2.21875,8.0781252 2.2063627,8.0601273 2.2022398,8.0390156 2.1901042,8.0208335 2.0314783,7.7831721 1.9016423,7.5422107 1.7890625,7.2760418 1.780945,7.2568499 1.7682791,7.2380747 1.7604167,7.2187502 1.6638208,6.9813345 1.5872342,6.7292671 1.53125,6.4739585 1.5206842,6.4257741 1.5116408,6.3794683 1.5026042,6.3307293 1.4799056,6.2083045 1.4580713,6.0839665 1.4453125,5.9583335 1.429665,5.8042552 1.4166667,5.6582067 1.4166667,5.5000002 c 0,-0.2178384 0.0279,-0.4204715 0.057292,-0.6302084 z" }
				PathSvg { path: "m 15,10.00008 v 1.00004 h -1 v 1.00004 h 1 v 1.00004 h 1 v -1.00004 h 1 V 11.00012 H 16 V 10.00008 Z M 20.5,9.9000762 A 0.6,0.600024 0 0 0 19.9,10.5001 0.6,0.600024 0 0 0 20.5,11.100124 0.6,0.600024 0 0 0 21.1,10.5001 0.6,0.600024 0 0 0 20.5,9.9000762 Z m -1,1.0000398 a 0.6,0.600024 0 0 0 -0.6,0.600024 0.6,0.600024 0 0 0 0.6,0.600024 0.6,0.600024 0 0 0 0.6,-0.600024 0.6,0.600024 0 0 0 -0.6,-0.600024 z m 2,0 a 0.6,0.600024 0 0 0 -0.6,0.600024 0.6,0.600024 0 0 0 0.6,0.600024 0.6,0.600024 0 0 0 0.6,-0.600024 0.6,0.600024 0 0 0 -0.6,-0.600024 z m -1,1.00004 a 0.6,0.600024 0 0 0 -0.6,0.600024 0.6,0.600024 0 0 0 0.6,0.600024 0.6,0.600024 0 0 0 0.6,-0.600024 0.6,0.600024 0 0 0 -0.6,-0.600024 z" }
				PathSvg { path: "M 14,8.0000002 A 2,4.00016 0 0 0 12,12.00016 v 2.5001 a 1.5,1.50006 0 0 0 2.56,1.060043 l 0.944,-0.943038 a 1.5,1.50006 0 0 0 0.996,0.383015 1.5,1.50006 0 0 0 1.5,-1.50006 1.5,1.50006 0 0 0 2.498,1.120045 l 0.941,0.940038 A 1.5,1.50006 0 0 0 24,14.50026 v -2.5001 A 2,4.00016 0 0 0 22,8.0000002 Z m 0,1.00004 h 8 a 1,3.00012 0 0 1 1,3.0001198 v 2.5001 a 0.5,0.50002 0 0 1 -0.854,0.354014 L 20.293,13.0002 H 20 v 0.50002 a 0.5,0.50002 0 0 1 -1,0 V 13.0002 h -2 v 0.50002 a 0.5,0.50002 0 0 1 -1,0 V 13.0002 h -0.293 l -1.853,1.854074 A 0.5,0.50002 0 0 1 13,14.50026 v -2.5001 a 1,3.00012 0 0 1 1,-3.0001198 z" }
				PathSvg { path: "m 2.75,13.000016 v 1.833334 5.752437 C 2.4795925,20.428954 2.169684,20.333337 1.8333343,20.333337 0.8176713,20.333337 0,21.151007 0,22.166668 0,23.182331 0.8176713,24 1.8333343,24 2.8489972,24 3.6666657,23.182331 3.6666657,22.166668 V 16.66667 h 6.4166683 v 2.085776 c -0.270407,-0.156823 -0.580316,-0.25245 -0.916668,-0.25245 -1.0156605,0 -1.8333317,0.817672 -1.8333317,1.833335 0,1.015658 0.8176712,1.833328 1.8333317,1.833328 C 10.182329,22.166659 11,21.348989 11,20.333331 V 13 Z m 0.9166657,1.833334 h 6.4166683 v 0.916666 H 3.6666657 Z" }
			}
			// SidebarItem {
			// 	icon.name: 'system-search-symbolic'
			// 	text: i18n("Search")
			// 	onClicked: searchResultsView.showDefaultSearch()
			// 	// checked: stackView.currentItem == searchResultsView
			// 	// checkedEdge: Qt.RightEdge
			// 	// checkedEdgeWidth: 4 * Screen.devicePixelRatio // Twice as thick as normal
			// }
		}
		ColumnLayout {
			anchors.bottom: parent.bottom
			spacing: 0

			SidebarItem {
				id: userMenuButton
				icon.name: kuser.hasFaceIcon ? kuser.faceIconUrl : 'user-identity'
				text: kuser.fullName
				onClicked: {
					userMenu.toggleOpen()
				}
				SidebarContextMenu {
					id: userMenu
					visualParent: userMenuButton
					model: appsModel.sessionActionsModel

					PlasmaExtras.MenuItem {
						icon: 'system-users'
						text: i18n("User Manager")
						onClicked: KCM.KCMLauncher.open('kcm_users')
						visible: KConfig.KAuthorized.authorizeControlModule('kcm_users')
					}

					// ... appsModel.sessionActionsModel
				}
			}

			SidebarFavouritesView {
				model: appsModel.sidebarModel
				maxHeight: sidebarMenu.height - sidebarMenuTop.height - 2 * config.flatButtonSize
			}

			SidebarItem {
				id: powerMenuButton
				icon.name: 'system-shutdown-symbolic'
				text: i18n("Power")
				onClicked: {
					powerMenu.toggleOpen()
				}
				SidebarContextMenu {
					id: powerMenu
					visualParent: powerMenuButton
					model: appsModel.powerActionsModel
				}
			}
		}

		onFocusChanged: {
			logger.debug('searchView.onFocusChanged', focus)
			if (!focus) {
				open = false
			}
		}
	}


}
